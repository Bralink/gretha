(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[582],{4594:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/video/[id]",function(){return n(1698)}])},6897:function(e,t,n){"use strict";var r=n(9755),o=n.n(r),i=n(7765);var s=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.host="https://api.grehta-capsulashipertension.com.mx",this.module="/web",this.controller="",this.action="",this.params=[],this.url="",this.session=[],this.notificationShow=!1,this.notificationMessage="",this.getJSON=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=t,s=(0,i.Z)(),a=s.getItem,c=s.setItem,l=a("sessionData")||"",u={token:""};""!==l&&"{}"!==l&&(u=JSON.parse(l)),t.controller=e,t.action=n,t.params=r,t.url=(void 0===t.host?"":t.host)+(void 0===t.module?"":t.module)+"/"+t.controller+"/"+t.action,t.url+="?token="+u.token,t.params.forEach((function(e){o.url+="&"+e.field+"="+e.value}));var d=fetch(t.url,{credentials:"include"}).then((function(e){var t=e.json();return t.then((function(e){e.status||-1===e.error&&(c("globalState",""),window.location.reload())})),t.status=!1,t.error=o.notificationMessage,t})).catch((function(){return{error:o.notificationMessage,status:!1}}));return d},this.sendData=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,o=t,s=(0,i.Z)(),a=s.getItem,c=s.setItem;t.controller=e,t.action=n;var l=a("globalState")||"",u={token:""};""!==l&&"{}"!==l&&(u=JSON.parse(l)),r.token=u.token,t.url=(void 0===t.host?"":t.host)+(void 0===t.module?"":t.module)+"/"+t.controller+"/"+t.action;var d={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},f=fetch(t.url,d).then((function(e){var t=e.json();return t.then((function(e){e.status||-1===e.error&&c("sessionData","")})),t.status=!1,t.error=o.notificationMessage,t})).catch((function(e){return{error:o.notificationMessage,status:!1}}));return f},this.makeURL=function(e,t){var n=sessionStorage.getItem("globalState")||"",r={token:""};return""!==n&&"{}"!==n&&(r=JSON.parse(n)),e+(void 0===t?"?":"&")+"token="+r.token},this.sendFile=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,i=t;t.controller=e,t.action=n;var s=sessionStorage.getItem("globalState")||"",a={token:""};""!==s&&"{}"!==s&&(a=JSON.parse(s)),r.append("token",a.token),t.url=(void 0===t.host?"":t.host)+(void 0===t.module?"":t.module)+"/"+t.controller+"/"+t.action;var c={method:"POST",body:r},l=fetch(t.url,c).then((function(e){var t=i,n=e.json();return n.then((function(e){if(!e.status){-1===e.error&&(sessionStorage.setItem("sessionData",""),window.location.reload()),t.notificationMessage=" error: ".concat(e.error),t.notificationShow=!0;var n='<div class="messageNotification"><div class="alert alert-danger alert-dismissible fade show" role="alert" style="width: 100%;"><strong>'.concat(t.notificationMessage,'</strong><button onClick="getElementById(\'mensajeError\').remove();" type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">\xd7</span></button></div></div>');o()(".c-wrapper").append(n)}})),n.status=!1,n.error=i.notificationMessage,o()("#loading").remove(),n})).catch((function(t){i.notificationMessage="Ocurrio un error en la llamada al controlador: (".concat(e,") en la acci\xf3n: (").concat(n,")"),i.notificationShow=!0;var r={error:i.notificationMessage,status:!1},s='<div id="messageNotification"><div class="alert alert-danger alert-dismissible fade show" role="alert" style="display: block; top: 20px; right: 20px; z-index: 99999; position: absolute; width: 300px;"><strong>'.concat(i.notificationMessage,'</strong><button onClick="getElementById(\'mensajeError\').remove();" type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">\xd7</span></button></div></div>');return o()(".c-wrapper").append(s),o()("#loading").remove(),r}));return l}}return e.prototype.getToken=function(){var e=sessionStorage.getItem("globalState")||"",t={token:""};return""!==e&&"{}"!==e&&(t=JSON.parse(e)),t.token},e}();t.Z=s},1698:function(e,t,n){"use strict";n.r(t),n.d(t,{VideoPage:function(){return _},__N_SSG:function(){return Z},default:function(){return T}});var r=n(4051),o=n.n(r),i=n(5893),s=n(682),a=n(1608),c=n(1555),l=n(1479),u=n(1163),d=n(7294),f=(n(4753),n(3106));function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var p=function e(){h(this,e),this.id=0,this.name="",this.url_video="",this.description="",this.active=1,this.date="",this.evaluation_id=0,this.sections=[],this.modulo="",this.part=0,this.is_answered=0},m=function e(){h(this,e),this.seen_video=0,this.time_seen=0,this.video=0},v=n(6897),g=n(1881);var y=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.plyr={currentTime:0,isPlayed:!1,isAfterMiddle:!1,isEmbed:!1,playing:!1,paused:!0,seeking:!1,duration:0}};function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(l){return void n(l)}a.done?t(c):Promise.resolve(c).then(r,o)}function w(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function s(e){b(i,r,o,s,a,"next",e)}function a(e){b(i,r,o,s,a,"throw",e)}s(void 0)}))}}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){j(e,t,n[t])}))}return e}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);s=!0);}catch(c){a=!0,o=c}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Z=!0,_=function(e){var t,n=e.id,r=(0,d.useContext)(g.kn).getGlobalState,h=(0,u.useRouter)(),x=new v.Z,b=k(d.useState({currentTime:0,isHalfPast:!1}),2),j=b[0],Z=b[1],_=(0,d.useRef)(new y),T=x.host+"/modules/admin/",E=k(d.useState(new p),2),O=E[0],C=E[1],N=k(d.useState(new m),2),P=N[0],A=N[1],M=k(d.useState(!0),2),I=M[0],D=M[1],J=k(d.useState(0),2),R=J[0],U=J[1],V=function(){var e=w(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==r().username){e.next=4;break}h.push("/login"),e.next=6;break;case 4:return e.next=6,x.sendData("video","getVideo",{idVideo:n}).then((function(e){e.status?C(S({},e.data)):-1===e.error&&h.push("/login")}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=w(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.sendData("video","saveUserVideo",P).then((function(e){e.status&&h.push("/quest/"+O.evaluation_id)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H=function(e){_.current.plyr.currentTime=e,j.isHalfPast&&_.current.plyr.play()};return(0,d.useEffect)((function(){_.current&&setTimeout((function(){var e;(null===(e=_.current)||void 0===e?void 0:e.plyr).on("play",(function(){_.current.plyr.isPlayed=!0,Z({currentTime:_.current.plyr.currentTime,isHalfPast:!0}),D(!1)}))}),1e3)}),[_]),(0,d.useEffect)((function(){0!==P.video&&void 0!==P.seen_video&&B()}),[P]),(0,d.useEffect)((function(){n>0&&0===O.id&&V()})),(0,d.useEffect)((function(){var e=Math.round(100*O.part/24);U(e)}),[O]),(0,d.useEffect)((function(){setTimeout((function(){H(1)}),100)}),[j]),(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(c.Z,{md:7}),(0,i.jsx)(c.Z,{md:1,xs:1,style:{textAlign:"right"},children:"0%"}),(0,i.jsxs)(c.Z,{xs:3,md:3,children:[(0,i.jsx)(a.Z,{xs:1,md:1,children:(0,i.jsx)(c.Z,{style:{paddingTop:"5px"},children:(0,i.jsx)(l.Z,{min:0,max:100,variant:"danger",label:"".concat(R,"%"),now:R})})}),(0,i.jsx)(a.Z,{xs:1,md:1,children:(0,i.jsxs)(c.Z,{style:{textAlign:"center"},children:[(t=O.modulo,t.replace(/(?:^\w|[A-Z\xc0-\xda]|\b\w)/g,(function(e,t){return 0===t?e:e.toLowerCase()})).replace(/\s+/g,""))," de 12 M\xf3dulos"]})})]}),(0,i.jsx)(c.Z,{md:1,xs:1,style:{textAlign:"left"},children:"100%"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsxs)(c.Z,{md:9,children:[(0,i.jsx)(a.Z,{xs:1,md:1,children:(0,i.jsx)(c.Z,{children:(0,i.jsx)(f.Z,{ref:_,preload:"none",source:{type:"video",sources:[{src:T+O.url_video}]}})})}),(0,i.jsx)(a.Z,{xs:1,md:1,children:(0,i.jsx)(c.Z,{style:{backgroundColor:"#e73952",borderRadius:"0.5em",marginRight:"5px"},children:3!==O.is_answered?(0,i.jsx)(a.Z,{style:{color:"white",textAlign:"center",paddingTop:"10px"},children:(0,i.jsx)(c.Z,{style:{backgroundColor:""},children:(0,i.jsxs)("a",{onClick:function(e){e.preventDefault(),A({seen_video:_.current.plyr.isPlayed?1:0,time_seen:_.current.plyr.currentTime,video:O.id})},className:"linkQuest",children:["Aplicar evaluaci\xf3n (Intento ",O.is_answered+1," de 3) "]})})}):(0,i.jsx)(a.Z,{style:{color:"white",textAlign:"center",paddingTop:"10px"},children:(0,i.jsx)(c.Z,{children:(0,i.jsx)("span",{children:"Evaluaci\xf3n Realizada"})})})})})]}),(0,i.jsxs)(c.Z,{md:3,className:"sectionsContainer",children:[(0,i.jsx)(a.Z,{xs:1,md:1,children:(0,i.jsx)(c.Z,{children:(0,i.jsx)(a.Z,{style:{color:"white",backgroundColor:"#e63a52",textAlign:"center",borderRadius:"0.75em"},xs:2,md:2,children:(0,i.jsx)(c.Z,{md:12,style:{paddingTop:"10px"},children:"Secciones"})})})}),(0,i.jsx)(a.Z,{className:"rowSections",xs:1,md:1,lg:1,children:void 0!==O.sections?O.sections.map((function(e){return(0,i.jsx)(c.Z,{style:{borderBottom:"1px solid lightgray"},children:(0,i.jsx)("button",{disabled:I,className:"buttonTopic",onClick:function(){return H(60*e.minute+e.second)},children:e.topic})},e.id)})):""})]})]})]})},T=_}},function(e){e.O(0,[571,143,774,888,179],(function(){return t=4594,e(e.s=t);var t}));var t=e.O();_N_E=t}]);